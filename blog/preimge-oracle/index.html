<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">What is a Pre-image Oracle and why is it awesome? | Willem Olding</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://willemolding.github.io/blog/preimge-oracle"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="research blockchain cryptocurrency cryptography"><meta data-rh="true" property="og:title" content="What is a Pre-image Oracle and why is it awesome? | Willem Olding"><meta data-rh="true" name="description" content="A pre-image oracle is a way to lookup any piece of data (pre-image) by its hash. While this sounds impossible (and in the general case is) it is possible to write code assuming such a thing exists if it operates in a context where execution cannot continue unless the pre-image is provided by an external party."><meta data-rh="true" property="og:description" content="A pre-image oracle is a way to lookup any piece of data (pre-image) by its hash. While this sounds impossible (and in the general case is) it is possible to write code assuming such a thing exists if it operates in a context where execution cannot continue unless the pre-image is provided by an external party."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-10-10T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/willemolding"><meta data-rh="true" property="article:tag" content="bridges,provable computation,fraud-proofs"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://willemolding.github.io/blog/preimge-oracle"><link data-rh="true" rel="alternate" href="https://willemolding.github.io/blog/preimge-oracle" hreflang="en"><link data-rh="true" rel="alternate" href="https://willemolding.github.io/blog/preimge-oracle" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Willem Olding RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Willem Olding Atom Feed"><link rel="stylesheet" href="/assets/css/styles.97af0be6.css">
<link rel="preload" href="/assets/js/runtime~main.b65da9e0.js" as="script">
<link rel="preload" href="/assets/js/main.95036704.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Willem Olding</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><div class="navbar__item"><style>
  @media screen and (max-width: 996px) {
    .custom_menu__link {
        color: var(--ifm-menu-color);
        flex: 1;
        line-height: 1.25;
        padding: var(--ifm-menu-link-padding-vertical)
          var(--ifm-menu-link-padding-horizontal);
    }
  }
</style>
<a target="_blank" rel="noopener noreferrer" class="navbar__link custom_menu__link" href="/resume.pdf">
  Resume
</a></div><a href="https://github.com/willemolding" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/feasibility-fault-proof-bridges">On the feasibility of a Fault-proof Based Blockchain Bridge</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/preimge-oracle">What is a Pre-image Oracle and why is it awesome?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/fair-airdrops">Fairer Airdrops - An Investigation (Video)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/fast-exits">Fast Exits from Optimistic Rollups (Video)</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">What is a Pre-image Oracle and why is it awesome?</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-10-10T00:00:00.000Z" itemprop="datePublished">October 10, 2022</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/willemolding" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/willemolding.png" alt="Willem Olding"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/willemolding" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Willem Olding</span></a></div><small class="avatar__subtitle" itemprop="description">Computer Systems Engineer, PhD</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>A pre-image oracle is a way to lookup any piece of data (pre-image) by its hash. While this sounds impossible (and in the general case is) it is possible to write code assuming such a thing exists if it operates in a context where execution cannot continue unless the pre-image is provided by an external party.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cannon-overview">Cannon Overview<a class="hash-link" href="#cannon-overview" title="Direct link to heading">​</a></h2><p>At a high level Optimism Cannon works by compiling some computation to the MIPS instruction set (the instruction set itself isn&#x27;t important, this was just the one they picked). This computation takes some input and produces some output.</p><p>A full proof of a computation could be considered as the <em>trace</em> of the execution of this code. That is the snapshot of the memory + registers (state) after the execution of each opcode from some initial state.</p><p>Proving fraud in a computation can be reduced to finding two adjacent states in the trace where both parties agree on the former state but disagree on the latter. The transition between these states can be verified by executing a single MIPS opcode to verify who is correct. This is small enough for a blockchain to execute and act as the final arbitrator.</p><p>Since the state may be large we don&#x27;t want to submit the whole thing on-chain. Each snapshot can be turned into a Merkle tree and only the root hash posted on-chain. Since they are merklized it is enough just to submit the roots and additionally provide proofs for:</p><ul><li>The opcode.</li><li>Any memory or registers the opcode reads from.</li></ul><p>These can be posted on-chain by either party and one of them is always incentivised to do so (the correct one).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-about-external-data">What about external data?<a class="hash-link" href="#what-about-external-data" title="Direct link to heading">​</a></h2><p>This is where the magic of the pre-image oracle comes in. Conceptually a pre-image oracle is a magic device that can return a piece of data given its hash. You can think of this as similar to how an IPFS PID is uniquely generated from data and can be used to retrieve the data from the network. <strong>Importantly, you can always check if the oracle is lying by hashing the provided data and ensuring it matches the hash you requested.</strong></p><p>In Cannon the proving code can pretend that such an oracle exists. It works as follows:</p><ul><li>The code places the hash of the data it wishes to access in a special memory slot</li><li>The host environment will then magically, and instantly, place the pre-image of this hash in another designated memory range</li></ul><p>From the code&#x27;s perspective it has the ability to retrieve any data in existance given its hash. How is this possible!? </p><p>This can be seen in the <a href="https://github.com/ethereum-optimism/cannon/blob/dfac3fb2e09bb974e77e6563a64d898d049a2a90/contracts/MIPSMemory.sol#L201" target="_blank" rel="noopener noreferrer">code for reading the MIPS memory</a>. It checks if the program is reading from the pre-defined pre-image oracle range <code>[0x31000000, 0x32000000]</code> and if so it checks that the hash of the data matches the hash in the hash stored in the special location (<code>0x30001000</code>).</p><p>It works because the host environment will simply not continue to execute if the pre-image is not provided by some actor off-chain. Since the case where the pre-image is not provided can never exist, the code can live in the happy reality where it always does.</p><p>This has an important implication:</p><ul><li><strong>If an execution requests the pre-image of a hash where the pre-image is not available then a fraud proof can never be completed.</strong> Special care must be taken to ensure this cannot happen by ensuring the data is available in the history of the host chain (including calldata). </li></ul><p>But also an amazing upside:</p><ul><li><strong>Verifyable computation code can access any data in the host chain history or state including anything submitted in calldata!</strong></li></ul></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/bridges">bridges</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/provable-computation">provable computation</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/fraud-proofs">fraud-proofs</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/feasibility-fault-proof-bridges"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">On the feasibility of a Fault-proof Based Blockchain Bridge</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/fair-airdrops"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Fairer Airdrops - An Investigation (Video)</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cannon-overview" class="table-of-contents__link toc-highlight">Cannon Overview</a></li><li><a href="#what-about-external-data" class="table-of-contents__link toc-highlight">What about external data?</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a href="https://github.com/willemolding" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://www.linkedin.com/in/willem-olding/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://twitter.com/WillemOlding1" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Willem Olding. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b65da9e0.js"></script>
<script src="/assets/js/main.95036704.js"></script>
</body>
</html>